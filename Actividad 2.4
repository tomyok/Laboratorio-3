-- 1.Listado con apellidos y nombres de los usuarios que no se hayan inscripto a cursos durante el año 2019.
Select Distinct DP.Nombres, DP.Apellidos From DatosPersonales DP
Inner Join Inscripciones I
On I.IDUsuario = DP.ID
Where I.IDUsuario Not In(
Select IDUsuario From Inscripciones Where Year(Fecha) = 2019
)

-- 2.Listado con apellidos y nombres de los usuarios que se hayan inscripto a cursos pero no hayan realizado ningún pago.
Select Distinct DP.Nombres, DP.Apellidos From DatosPersonales DP
Inner Join Inscripciones I
On I.IDUsuario = DP.ID
Where I.IDUsuario Not In(
Select I.IDUsuario From Inscripciones I
Inner Join Pagos P
On P.IDInscripcion = I.ID
)

-- 3.Listado de países que no tengan usuarios relacionados.
Select Distinct P.Nombre From Paises P Where P.Nombre Not In(
Select Distinct P.Nombre From Paises P
Inner Join Localidades_ L
On L.IDPais = P.ID
Inner Join DatosPersonales DP
On DP.IDLocalidad = L.ID
)

-- 4.Listado de clases cuya duración sea mayor a la duración promedio.
Select C.Nombre As NombreDeLaClase, C.Duracion From Clases C Where C.Duracion > (
Select Avg(Duracion) As Duracion From Clases
)

-- 5.Listado de contenidos cuyo tamaño sea mayor al tamaño de todos los contenidos de tipo 'Audio de alta calidad'.
Select C.ID As IDContenidosMayores From Contenidos C Where C.Tamaño > (
Select Max(C.Tamaño) From Contenidos C
Inner Join TiposContenido TP
On TP.ID = C.IDTipo
Where C.IDTipo = 1
)
-- Usando All.
Select C.ID As IDContenidosMayores From Contenidos C Where C.Tamaño > All(
Select C.Tamaño From Contenidos C
Inner Join TiposContenido TP
On TP.ID = C.IDTipo
Where C.IDTipo = 1
)

-- 6.Listado de contenidos cuyo tamaño sea menor al tamaño de algún contenido de tipo 'Audio de alta calidad'.
Select C.ID As IDContenidosMenores From Contenidos C Where C.Tamaño < (
Select Max(C.Tamaño) From Contenidos C
Inner Join TiposContenido TP
On TP.ID = C.IDTipo
Where C.IDTipo = 1
)
-- Usando Any.
Select C.ID As IDContenidosMenores From Contenidos C Where C.Tamaño < Any(
Select C.Tamaño From Contenidos C
Inner Join TiposContenido TP
On TP.ID = C.IDTipo
Where C.IDTipo = 1
)

-- 7.Listado con nombre de país y la cantidad de usuarios de género masculino y la cantidad de usuarios de género femenino que haya registrado.

Select PM.Nombre As Pais,
(
Select Count(DP.Genero) From DatosPersonales DP
Inner Join Localidades_ L
On L.ID = DP.IDLocalidad
Where DP.Genero Like 'M' and PM.ID = L.IDPais) As CantMas,
(
Select Count(DP.Genero) From DatosPersonales DP
Inner Join Localidades_ L
On L.ID = DP.IDLocalidad
Where DP.Genero Like 'F' and PM.ID = L.IDPais)
As CantFem 
From Paises PM

-- 8.Listado con apellidos y nombres de los usuarios y la cantidad de inscripciones realizadas en el 2019 y la cantidad de inscripciones realizadas en el 2020.
Select DP.Apellidos + ', ' + DP.Nombres As ApellidoyNombre,
(
Select Count(I.IDUsuario) From Inscripciones I Where Year(I.Fecha) = 2019 And I.IDUsuario = DP.ID
) As CantInscripciones2019,
(
Select Count(I.IDUsuario) From Inscripciones I Where Year(I.Fecha) = 2020 And I.IDUsuario = DP.ID
) As CantInscripciones2020
From DatosPersonales DP

-- 9.Listado con nombres de los cursos y la cantidad de idiomas de cada tipo. Es decir, la cantidad de idiomas de audio, la cantidad de subtítulos y la cantidad de texto de video.
Select C.Nombre As Curso, I.Nombre As NomIdiomasPorCurso,
(Select Count(IDFormatoIdioma) From Idiomas_x_Curso Where IDFormatoIdioma = 2 And IDCurso = C.ID And I.ID = IDIdioma) As CantAudio,
(Select Count(IDFormatoIdioma) From Idiomas_x_Curso Where IDFormatoIdioma = 1 And IDCurso = C.ID And I.ID = IDIdioma) As CantSubtitulo,
(Select Count(IDFormatoIdioma) From Idiomas_x_Curso Where IDFormatoIdioma = 3 And IDCurso = C.ID And I.ID = IDIdioma) As CantVideo
From Cursos C
Inner Join Idiomas_x_Curso IXC
On IXC.IDCurso = C.ID
Inner Join Idiomas I
On I.ID = IXC.IDIdioma
Group By C.Nombre, C.ID, I.Nombre, I.ID
